/**
 * @author lipeilin
 * @date 2025/12/2
 * @project demo
 * @description ï¼ˆåŒ…æ‹¬@Stateã€@Propã€@Linkã€@Provideå’Œ@Consumeè£…é¥°å™¨ï¼‰ä»…èƒ½è§‚å¯Ÿåˆ°ç¬¬ä¸€å±‚çš„å˜åŒ–ï¼Œ
 * ä½†æ˜¯åœ¨å®é™…åº”ç”¨å¼€å‘ä¸­ï¼Œåº”ç”¨ä¼šæ ¹æ®å¼€å‘éœ€è¦ï¼Œå°è£…è‡ªå·±çš„æ•°æ®æ¨¡å‹ã€‚å¯¹äºå¤šå±‚åµŒå¥—çš„æƒ…å†µ,ä¸ºäº†å®ç°å¯¹åµŒå¥—æ•°æ®ç»“æ„ä¸­æ·±å±‚å±æ€§å˜åŒ–çš„è§‚å¯Ÿï¼Œå¼•å…¥äº†@Observedå’Œ@ObjectLinkè£…é¥°å™¨ã€‚
 *
 * @ObjectLinkå’Œ@Observedç±»è£…é¥°å™¨ç”¨äºåµŒå¥—å¯¹è±¡æˆ–æ•°ç»„çš„åœºæ™¯ä¸­è¿›è¡ŒåŒå‘æ•°æ®åŒæ­¥ï¼š
 * @Observedï¼šç»™ ç±» æ‰“æ ‡ â€”â€”ã€Œè¿™ä¸ªç±»çš„å®ä¾‹å±æ€§å˜åŒ–è¦è¢« UI è¿½è¸ªã€ å¯è§‚å¯Ÿçš„æ¨¡å‹ç±»
 * @ObjectLinkï¼šç»™ å­ç»„ä»¶é‡Œçš„å˜é‡ æ‰“æ ‡ â€”â€”ã€Œè¿™ä¸ªå˜é‡æŒ‡å‘çˆ¶ç»„ä»¶é‡Œçš„æŸä¸ª @Observed å¯¹è±¡ï¼Œä¸¤è¾¹å±æ€§æ”¹äº†è¦åŒå‘åŒæ­¥ã€
 * ä¸€èˆ¬æ˜¯ ç»„åˆä½¿ç”¨ï¼š@Observed + @ObjectLink æ¥è§£å†³ã€ŒåµŒå¥—å¯¹è±¡ / æ•°ç»„é¡¹ã€çš„è”åŠ¨æ›´æ–°é—®é¢˜ã€‚
 *
 */

// åªèƒ½è£…é¥° classï¼Œä¸èƒ½è£…é¥° interface / type
@Observed
export class TodoItem {
  id: number = 0;
  title: string = "";
  done: boolean = false

  // å¿…é¡»å£°æ˜æ„é€ å‡½æ•°
  constructor(id: number, title: string, done: boolean = false) {
    this.id = id;
    this.title = title;
    this.done = done;
  }
}

@Component
struct TodoItemView {
  /**
   * 1ã€è£…é¥°çš„å˜é‡ç±»å‹ å¿…é¡»æ˜¯è¢« @Observed è£…é¥°çš„ class ç±»å‹
   * 2ã€ä¸æ”¯æŒç®€å•ç±»å‹
   * 3ã€å˜é‡æœ¬èº«ä¸èƒ½é‡æ–°èµ‹å€¼ï¼Œåªèƒ½æ”¹å˜å…¶å†…éƒ¨å±æ€§
   * 4ã€ä¸èƒ½å†™é»˜è®¤å€¼
   * 5ã€çˆ¶ç»„ä»¶ä¼ å…¥å¿…é¡»æ˜¯ç”±æŸä¸ªè£…é¥°å™¨è£…é¥°ï¼ˆ@State/@Link/@Prop/@StorageLink/@Provide/@Consumeç­‰ï¼‰
   */
  @ObjectLink
  todo: TodoItem

  build() {
    Row() {
      Checkbox({ name: "done", group: "todos" }).onChange((value: boolean) => {
        this.todo.done = value;
      })
      Text(this.todo.title)
        .margin({ left: 8 })
        .decoration({
          type: this.todo.done ? TextDecorationType.LineThrough : TextDecorationType.None
        })
    }
    .padding(8)
  }
}

@Entry
@Component
struct TodoListPage {
  @State todos: TodoItem[] = [
    new TodoItem(1, 'å­¦ä¹  ArkTS çŠ¶æ€ç®¡ç†'),
    new TodoItem(2, 'å†™ä¸€ä¸ª HarmonyOS NEXT Demo'),
    new TodoItem(3, 'ä¼‘æ¯ä¸€ä¸‹ ğŸ˜„'),
  ];
  // @State åªèƒ½è§‚æµ‹ç¬¬ä¸€å±‚å±æ€§å˜åŒ–ï¼Œä¸èƒ½è§‚æµ‹â€œåµŒå¥—å±æ€§â€çš„èµ‹å€¼
  @State profile: UserProfile = new UserProfile('Brin', 'brin@example.com');

  build() {
    Column() {
      ForEach(this.todos, (item: TodoItem) => {
        // æ³¨æ„è¿™é‡Œç›´æ¥ä¼  itemï¼Œç±»å‹æ˜¯ TodoItemï¼ˆå·² @Observedï¼‰
        TodoItemView({ todo: item })
      }, (item: TodoItem) => item.id.toString())
      // æ˜¾ç¤ºåŸºç¡€èµ„æ–™
      Text(`å§“åï¼š${this.profile.name}`).fontSize(20)
      Text(`é‚®ç®±ï¼š${this.profile.email}`).fontSize(16).margin({ bottom: 16 })

      // æŠŠåµŒå¥—çš„ settings ä¸¢ç»™å­ç»„ä»¶ï¼Œå»ºç«‹ @ObjectLink
      ProfileView({ profile: this.profile })
      // ä¸‹é¢è¿™ä¸ª Text ä¼šéšç€ settings çš„å˜åŒ–é‡æ–°æ¸²æŸ“
      Text(`çˆ¶ç»„ä»¶@State å½“å‰è®¾ç½®,ä¸ä¼šåˆ·æ–°UIï¼špush=${this.profile.settings.pushEnabled}, email=${this.profile.settings.emailEnabled}`)
        .margin({ top: 16 })
    }
    .alignItems(HorizontalAlign.Start)
    .padding(16)
  }
}


// åµŒå¥—å¯è§‚å¯Ÿç±»
@Observed
export class UserSettings {
  pushEnabled: boolean = true;
  emailEnabled: boolean = false;
}

@Observed
export class UserProfile {
  name: string = '';
  email: string = '';
  settings: UserSettings = new UserSettings(); // åµŒå¥— Observed

  constructor(name: string, email: string) {
    this.name = name;
    this.email = email;
    this.settings = new UserSettings();
  }
}

@Component
export struct ProfileView {
  @ObjectLink
  profile: UserProfile;   // è¿™é‡Œå¯ä»¥ç”¨ @ObjectLinkï¼Œå› ä¸ºä¸æ˜¯ @Entry

  build() {
    Column() {
      // è¿™é‡Œçš„ Text å°±è·Ÿç€ profile.settings å˜åŒ–ä¸€èµ·åˆ·æ–°äº†
      Text(`çˆ¶ç»„ä»¶å½“å‰è®¾ç½® ä¼šåˆ·æ–°UIï¼špush=${this.profile.settings.pushEnabled}, email=${this.profile.settings.emailEnabled}`)
        .margin({ top: 16 })
      SettingsPanel({ settings: this.profile.settings })

    }
  }
}

// å­ç»„ä»¶åªå…³å¿ƒåµŒå¥—çš„settings
@Component
export struct SettingsPanel {
  @ObjectLink
  settings: UserSettings;

  build() {
    Column() {
      Row() {
        Text("æ¨é€é€šçŸ¥")
        Toggle({ type: ToggleType.Switch, isOn: this.settings.pushEnabled })
          .onChange((isOn: boolean) => {
            this.settings.pushEnabled = isOn
          })
      }.padding(8)

      Row() {
        Text("é‚®ä»¶é€šçŸ¥")
        Toggle({ type: ToggleType.Switch, isOn: this.settings.emailEnabled })
          .onChange((isOn: boolean) => {
            this.settings.emailEnabled = isOn
          })
      }.padding(8)

      Text(`å­ç»„ä»¶å½“å‰è®¾ç½®ï¼špush=${this.settings.pushEnabled}, email=${this.settings.emailEnabled}`)
        .margin({ top: 16 })
    }
  }
}